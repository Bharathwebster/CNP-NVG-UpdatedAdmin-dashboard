{"version":3,"sources":["ngx-ui-scroll.umd.js"],"names":["global","factory","exports","module","require","define","amd","ng","ngxUiScroll","core","common","Rx","this","Observable","BehaviorSubject","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","assignBoolean","target","source","token","defaults","param","console","warn","assignNumeric","integer","parseInt","toString","assignMinimalNumeric","minSettings","assignSettings","settings","defaultSettings","startIndex","bufferSize","padding","infinite","horizontal","Settings","debug","itemIdPrefix","clipAfterFetchOnly","clipAfterScrollOnly","Direction","forward","backward","Routines","getScrollPosition","element","setScrollPosition","value","getParams","getBoundingClientRect","getSize","getSizeStyle","style","setSizeStyle","getScrollableSize","getRectEdge","params","direction","opposite","getEdge","getEdge2","relativeElement","offsetTop","scrollTop","hideElement","display","Padding","routines","querySelector","defineProperty","get","set","enumerable","configurable","ViewportPadding","Viewport","elementRef","host","nativeElement","scrollable","parentElement","syntheticScrollPosition","children","scrollPosition","saveScrollPosition","lastPosition","getLastPosition","getBufferPadding","getLimit","ItemCache","item","$index","nodeId","data","Cache","items","add","found","find","push","index","Index","Buffer","$items","bof","eof","lastIndex","cache","_items","setLastIndices","next","getFirstVisibleItemIndex","invisible","getLastVisibleItemIndex","getEdgeVisibleItemIndex","getFirstVisibleItem","getLastVisibleItem","getEdgeVisibleItem","FetchByDirection","count","reset","shouldFetch","_newItemsData","FetchModel","concat","newItemsData","ClipByDirection","shouldClip","size","ClipModel","checkDatasource","datasource","Error","Workflow","context","_this","countDone","resolver","create","_observer","observer","bindData","changeDetector","markForCheck","viewport","buffer","fetch","clip","pending","scroll","start","options","log","Promise","resolve","continue","finalize","end","done","fail","error","dispose","complete","args","_i","apply","ShouldFetch","run","workflow","shouldFetchByDirection","paddingEdge","limit","setStartIndex","back","Fetch","result","fetchByDirection","all","then","success","reject","_getResult","_get","subscribe","Item","hide","ProcessFetch","runByDirection","map","String","Render","hasNewItems","setTimeout","setElements","j","nodes","getAttribute","AdjustFetch","processFetchedItems","height","Math","abs","adjustForward","adjustBackward","left","position","paddingForward","_paddingSize","max","_scrollPosition","paddingBackward","paddingSize","paddingDiff","diff","ShouldClip","fetchOnly","scrollOnly","shouldClipByDirection","itemEdge","viewportLimit","firstIndex","firstItemEdge","lastItemEdge","toRemove","Clip","filter","processClip","WorkflowRunner","defaultDirection","runQueue","runNew","initialize","flow","onScrollListener","renderer","listen","func","wait","timeout","previous","later","leading","Date","now","remaining","clearTimeout","trailing","throttle","$event","itemsSubscription","flowResolverSubscription","bind","catch","unsubscribe","UiScrollComponent","ngOnInit","workflowRunner","ngOnDestroy","decorators","type","Component","selector","changeDetection","ChangeDetectionStrategy","OnPush","template","ctorParameters","ChangeDetectorRef","ElementRef","Renderer2","UiScrollDirective","templateRef","viewContainer","templateView","createEmbeddedView","compFactory","resolveComponentFactory","componentRef","createComponent","injector","rootNodes","instance","Directive","TemplateRef","ViewContainerRef","ComponentFactoryResolver","propDecorators","uiScrollOf","Input","UiScrollModule","NgModule","declarations","imports","CommonModule","entryComponents","providers","ɵa","ɵb"],"mappings":"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","file":"ngx-ui-scroll.umd.min.js.map","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('@angular/common'), require('rxjs/Observable'), require('rxjs/BehaviorSubject')) :\n\ttypeof define === 'function' && define.amd ? define(['exports', '@angular/core', '@angular/common', 'rxjs/Observable', 'rxjs/BehaviorSubject'], factory) :\n\t(factory((global.ng = global.ng || {}, global.ng.ngxUiScroll = {}),global.ng.core,global.ng.common,global.Rx,global.Rx));\n}(this, (function (exports,core,common,Observable,BehaviorSubject) { 'use strict';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\n\r\n\r\nvar __assign = Object.assign || function __assign(t) {\r\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n        s = arguments[i];\r\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n    }\r\n    return t;\r\n};\n\n/**\n * @license ngx-ui-scroll\n * MIT license\n */\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar assignBoolean = function (target, source, token, defaults) {\r\n    var /** @type {?} */ param = source[token];\r\n    if (typeof param === 'undefined') {\r\n        return;\r\n    }\r\n    if (typeof param !== 'boolean') {\r\n        console.warn(token + ' setting parse error, set it to ' + defaults[token] + ' (default)');\r\n        return;\r\n    }\r\n    target[token] = param;\r\n    return true;\r\n};\r\nvar assignNumeric = function (target, source, token, defaults, integer) {\r\n    if (integer === void 0) { integer = false; }\r\n    var /** @type {?} */ param = source[token];\r\n    if (typeof param === 'undefined') {\r\n        return;\r\n    }\r\n    if (typeof param !== 'number') {\r\n        console.warn(token + ' setting parse error, set it to ' + defaults[token] + ' (default)');\r\n        return;\r\n    }\r\n    if (integer && parseInt(param.toString(), 10) !== param) {\r\n        console.warn(token + ' setting parse error, set it to ' + defaults[token] + ' (default)');\r\n        return;\r\n    }\r\n    target[token] = param;\r\n    return true;\r\n};\r\nvar assignMinimalNumeric = function (target, source, token, defaults, minSettings, integer) {\r\n    if (integer === void 0) { integer = false; }\r\n    if (assignNumeric(target, source, token, defaults, integer) !== true) {\r\n        return;\r\n    }\r\n    if (target[token] < minSettings[token]) {\r\n        console.warn(token + ' setting is less than minimum, set it to ' + minSettings[token]);\r\n        target[token] = minSettings[token];\r\n        return;\r\n    }\r\n    return true;\r\n};\r\nvar assignSettings = function (target, settings, defaults, minSettings) {\r\n    Object.assign(target, defaults);\r\n    if (typeof settings === 'undefined') {\r\n        return;\r\n    }\r\n    if (typeof settings !== 'object') {\r\n        console.warn('settings is not an object, fallback to the defaults');\r\n        return;\r\n    }\r\n    assignNumeric(target, settings, 'startIndex', defaults);\r\n    assignMinimalNumeric(target, settings, 'bufferSize', defaults, minSettings, true);\r\n    assignMinimalNumeric(target, settings, 'padding', defaults, minSettings);\r\n    assignBoolean(target, settings, 'infinite', defaults);\r\n    assignBoolean(target, settings, 'horizontal', defaults);\r\n    // undocumented settings, for tests only\r\n    assignBoolean(target, settings, 'clipAfterFetchOnly', defaults);\r\n    assignBoolean(target, settings, 'clipAfterScrollOnly', defaults);\r\n};\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar defaultSettings = {\r\n    startIndex: 1,\r\n    bufferSize: 5,\r\n    padding: 0.5,\r\n    infinite: false,\r\n    horizontal: false\r\n};\r\nvar minSettings = {\r\n    bufferSize: 1,\r\n    padding: 0.1\r\n};\r\nvar Settings = /** @class */ (function () {\r\n    function Settings(settings) {\r\n        // internal settings\r\n        this.debug = false;\r\n        this.itemIdPrefix = '';\r\n        this.clipAfterFetchOnly = true;\r\n        this.clipAfterScrollOnly = true;\r\n        assignSettings(this, settings, defaultSettings, minSettings);\r\n    }\r\n    return Settings;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\n/** @enum {string} */\r\nvar Direction = {\r\n    forward: 'forward',\r\n    backward: 'backward',\r\n};\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar Routines = /** @class */ (function () {\r\n    function Routines(settings) {\r\n        this.horizontal = settings.horizontal;\r\n    }\r\n    /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.getScrollPosition = /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    function (element) {\r\n        return element[this.horizontal ? 'scrollLeft' : 'scrollTop'];\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @param {?} value\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.setScrollPosition = /**\r\n     * @param {?} element\r\n     * @param {?} value\r\n     * @return {?}\r\n     */\r\n    function (element, value) {\r\n        element[this.horizontal ? 'scrollLeft' : 'scrollTop'] = value;\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.getParams = /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    function (element) {\r\n        return element.getBoundingClientRect();\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.getSize = /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    function (element) {\r\n        return this.getParams(element)[this.horizontal ? 'width' : 'height'];\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.getSizeStyle = /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    function (element) {\r\n        return parseInt(element.style[this.horizontal ? 'width' : 'height'], 10) || 0;\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @param {?} value\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.setSizeStyle = /**\r\n     * @param {?} element\r\n     * @param {?} value\r\n     * @return {?}\r\n     */\r\n    function (element, value) {\r\n        element.style[this.horizontal ? 'width' : 'height'] = value + \"px\";\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.getScrollableSize = /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    function (element) {\r\n        return element[this.horizontal ? 'scrollWidth' : 'scrollHeight'];\r\n    };\r\n    /**\r\n     * @param {?} params\r\n     * @param {?} direction\r\n     * @param {?} opposite\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.getRectEdge = /**\r\n     * @param {?} params\r\n     * @param {?} direction\r\n     * @param {?} opposite\r\n     * @return {?}\r\n     */\r\n    function (params, direction, opposite) {\r\n        var /** @type {?} */ forward = !opposite ? Direction.forward : Direction.backward;\r\n        return params[direction === forward ? (this.horizontal ? 'right' : 'bottom') : (this.horizontal ? 'left' : 'top')];\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @param {?} direction\r\n     * @param {?} opposite\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.getEdge = /**\r\n     * @param {?} element\r\n     * @param {?} direction\r\n     * @param {?} opposite\r\n     * @return {?}\r\n     */\r\n    function (element, direction, opposite) {\r\n        var /** @type {?} */ params = this.getParams(element);\r\n        return this.getRectEdge(params, direction, opposite);\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @param {?} direction\r\n     * @param {?} relativeElement\r\n     * @param {?} opposite\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.getEdge2 = /**\r\n     * @param {?} element\r\n     * @param {?} direction\r\n     * @param {?} relativeElement\r\n     * @param {?} opposite\r\n     * @return {?}\r\n     */\r\n    function (element, direction, relativeElement, opposite) {\r\n        // vertical only ?\r\n        return element.offsetTop - (relativeElement ? relativeElement.scrollTop : 0) +\r\n            (direction === (!opposite ? Direction.forward : Direction.backward) ? this.getSize(element) : 0);\r\n    };\r\n    /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    Routines.prototype.hideElement = /**\r\n     * @param {?} element\r\n     * @return {?}\r\n     */\r\n    function (element) {\r\n        element.style.display = 'none';\r\n    };\r\n    return Routines;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar Padding = /** @class */ (function () {\r\n    function Padding(element, direction, routines) {\r\n        this.element = null;\r\n        this.element = element.querySelector(\"[data-padding-\" + direction + \"]\");\r\n        this.direction = direction;\r\n        this.routines = routines;\r\n    }\r\n    Object.defineProperty(Padding.prototype, \"size\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return this.routines.getSizeStyle(this.element);\r\n        },\r\n        set: /**\r\n         * @param {?} value\r\n         * @return {?}\r\n         */\r\n        function (value) {\r\n            this.routines.setSizeStyle(this.element, value);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Padding.prototype.getEdge = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return this.routines.getEdge(this.element, this.direction, true);\r\n    };\r\n    return Padding;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar ViewportPadding = /** @class */ (function () {\r\n    function ViewportPadding(element, routines) {\r\n        this.forward = new Padding(element, Direction.forward, routines);\r\n        this.backward = new Padding(element, Direction.backward, routines);\r\n    }\r\n    return ViewportPadding;\r\n}());\r\nvar Viewport = /** @class */ (function () {\r\n    function Viewport(elementRef, settings, routines) {\r\n        this.settings = settings;\r\n        this.routines = routines;\r\n        this.host = elementRef.nativeElement;\r\n        this.scrollable = elementRef.nativeElement.parentElement;\r\n        this.padding = new ViewportPadding(this.host, this.routines);\r\n        this.syntheticScrollPosition = null;\r\n    }\r\n    Object.defineProperty(Viewport.prototype, \"children\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return this.host.children;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Viewport.prototype, \"scrollPosition\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return this.routines.getScrollPosition(this.scrollable);\r\n        },\r\n        set: /**\r\n         * @param {?} value\r\n         * @return {?}\r\n         */\r\n        function (value) {\r\n            this.routines.setScrollPosition(this.scrollable, value);\r\n            this.syntheticScrollPosition = this.scrollPosition;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Viewport.prototype.saveScrollPosition = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.lastPosition = this.scrollPosition;\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Viewport.prototype.getLastPosition = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return this.lastPosition;\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Viewport.prototype.getSize = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return this.routines.getSize(this.scrollable);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Viewport.prototype.getScrollableSize = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return this.routines.getScrollableSize(this.scrollable);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Viewport.prototype.getBufferPadding = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return this.getSize() * this.settings.padding;\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?=} opposite\r\n     * @return {?}\r\n     */\r\n    Viewport.prototype.getEdge = /**\r\n     * @param {?} direction\r\n     * @param {?=} opposite\r\n     * @return {?}\r\n     */\r\n    function (direction, opposite) {\r\n        return this.routines.getEdge(this.scrollable, direction, opposite);\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?=} opposite\r\n     * @return {?}\r\n     */\r\n    Viewport.prototype.getLimit = /**\r\n     * @param {?} direction\r\n     * @param {?=} opposite\r\n     * @return {?}\r\n     */\r\n    function (direction, opposite) {\r\n        return this.getEdge(direction, opposite) +\r\n            (direction === (!opposite ? Direction.forward : Direction.backward) ? 1 : -1) * this.getBufferPadding();\r\n    };\r\n    return Viewport;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar ItemCache = /** @class */ (function () {\r\n    function ItemCache(item) {\r\n        this.$index = item.$index;\r\n        this.nodeId = item.nodeId;\r\n        this.data = item.data;\r\n        this.params = item.getParams();\r\n    }\r\n    return ItemCache;\r\n}());\r\nvar Cache = /** @class */ (function () {\r\n    function Cache() {\r\n        this.items = [];\r\n    }\r\n    /**\r\n     * @param {?} item\r\n     * @return {?}\r\n     */\r\n    Cache.prototype.add = /**\r\n     * @param {?} item\r\n     * @return {?}\r\n     */\r\n    function (item) {\r\n        var /** @type {?} */ found = this.items.find(function (i) { return i.$index === item.$index; });\r\n        if (found) {\r\n            found.data = item.data;\r\n            found.params = item.getParams();\r\n        }\r\n        else {\r\n            // todo: do we need the list to be sorted? maybe an object?\r\n            this.items.push(new ItemCache(item));\r\n        }\r\n    };\r\n    /**\r\n     * @param {?} index\r\n     * @return {?}\r\n     */\r\n    Cache.prototype.get = /**\r\n     * @param {?} index\r\n     * @return {?}\r\n     */\r\n    function (index) {\r\n        return this.items.find(function (i) { return i.$index === index; });\r\n    };\r\n    return Cache;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar Index = /** @class */ (function () {\r\n    function Index() {\r\n        this.forward = null;\r\n        this.backward = null;\r\n    }\r\n    return Index;\r\n}());\r\nvar Buffer = /** @class */ (function () {\r\n    function Buffer() {\r\n        this.$items = new BehaviorSubject.BehaviorSubject(null);\r\n        this.items = [];\r\n        this.bof = false;\r\n        this.eof = false;\r\n        this.lastIndex = new Index();\r\n        this.cache = new Cache();\r\n    }\r\n    Object.defineProperty(Buffer.prototype, \"items\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return this._items;\r\n        },\r\n        set: /**\r\n         * @param {?} items\r\n         * @return {?}\r\n         */\r\n        function (items) {\r\n            this._items = items;\r\n            if (items.length) {\r\n                this.setLastIndices();\r\n            }\r\n            this.$items.next(items);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Buffer.prototype.setLastIndices = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.lastIndex[Direction.backward] = this.items[0].$index;\r\n        this.lastIndex[Direction.forward] = this.items[this.items.length - 1].$index;\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Buffer.prototype.getFirstVisibleItemIndex = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        var /** @type {?} */ length = this.items.length;\r\n        for (var /** @type {?} */ i = 0; i < length; i++) {\r\n            if (!this.items[i].invisible) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Buffer.prototype.getLastVisibleItemIndex = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        for (var /** @type {?} */ i = this.items.length - 1; i >= 0; i--) {\r\n            if (!this.items[i].invisible) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?=} opposite\r\n     * @return {?}\r\n     */\r\n    Buffer.prototype.getEdgeVisibleItemIndex = /**\r\n     * @param {?} direction\r\n     * @param {?=} opposite\r\n     * @return {?}\r\n     */\r\n    function (direction, opposite) {\r\n        return direction === (!opposite ? Direction.forward : Direction.backward) ?\r\n            this.getLastVisibleItemIndex() : this.getFirstVisibleItemIndex();\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Buffer.prototype.getFirstVisibleItem = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        var /** @type {?} */ index = this.getFirstVisibleItemIndex();\r\n        if (index >= 0) {\r\n            return this.items[index];\r\n        }\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Buffer.prototype.getLastVisibleItem = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        var /** @type {?} */ index = this.getLastVisibleItemIndex();\r\n        if (index >= 0) {\r\n            return this.items[index];\r\n        }\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?=} opposite\r\n     * @return {?}\r\n     */\r\n    Buffer.prototype.getEdgeVisibleItem = /**\r\n     * @param {?} direction\r\n     * @param {?=} opposite\r\n     * @return {?}\r\n     */\r\n    function (direction, opposite) {\r\n        return direction === (!opposite ? Direction.forward : Direction.backward) ?\r\n            this.getLastVisibleItem() : this.getFirstVisibleItem();\r\n    };\r\n    return Buffer;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar FetchByDirection = /** @class */ (function () {\r\n    function FetchByDirection() {\r\n        this.count = 0;\r\n        this.reset();\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    FetchByDirection.prototype.reset = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        var /** @type {?} */ count = this.count;\r\n        this.shouldFetch = false;\r\n        this.startIndex = null;\r\n        this._newItemsData = null;\r\n        this.items = null;\r\n        this.count = count;\r\n    };\r\n    Object.defineProperty(FetchByDirection.prototype, \"newItemsData\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return this._newItemsData;\r\n        },\r\n        set: /**\r\n         * @param {?} items\r\n         * @return {?}\r\n         */\r\n        function (items) {\r\n            this._newItemsData = items;\r\n            this.count++;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return FetchByDirection;\r\n}());\r\nvar FetchModel = /** @class */ (function () {\r\n    function FetchModel() {\r\n        this.forward = new FetchByDirection();\r\n        this.backward = new FetchByDirection();\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    FetchModel.prototype.reset = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this[Direction.forward].reset();\r\n        this[Direction.backward].reset();\r\n    };\r\n    Object.defineProperty(FetchModel.prototype, \"count\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return this[Direction.backward].count + this[Direction.forward].count;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FetchModel.prototype, \"items\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return (this[Direction.backward].items ? this[Direction.backward].items : []).concat(this[Direction.forward].items ? this[Direction.forward].items : []);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FetchModel.prototype, \"shouldFetch\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return this[Direction.forward].shouldFetch || this[Direction.backward].shouldFetch;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FetchModel.prototype, \"hasNewItems\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return !!(this[Direction.forward].newItemsData || this[Direction.backward].newItemsData);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return FetchModel;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar ClipByDirection = /** @class */ (function () {\r\n    function ClipByDirection() {\r\n        this.shouldClip = false;\r\n        this.size = null;\r\n    }\r\n    return ClipByDirection;\r\n}());\r\nvar ClipModel = /** @class */ (function () {\r\n    function ClipModel() {\r\n        this.forward = new ClipByDirection();\r\n        this.backward = new ClipByDirection();\r\n    }\r\n    Object.defineProperty(ClipModel.prototype, \"shouldClip\", {\r\n        get: /**\r\n         * @return {?}\r\n         */\r\n        function () {\r\n            return this[Direction.forward].shouldClip || this[Direction.backward].shouldClip;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return ClipModel;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\n/**\r\n * @param {?} func\r\n * @param {?} wait\r\n * @param {?=} options\r\n * @return {?}\r\n */\r\nfunction throttle(func, wait, options) {\r\n    var /** @type {?} */ context, /** @type {?} */ args, /** @type {?} */ result;\r\n    var /** @type {?} */ timeout = null;\r\n    var /** @type {?} */ previous = 0;\r\n    if (!options) {\r\n        options = {};\r\n    }\r\n    var /** @type {?} */ later = function () {\r\n        previous = options.leading === false ? 0 : Date.now();\r\n        timeout = null;\r\n        result = func.apply(context, args);\r\n        if (!timeout) {\r\n            context = args = null;\r\n        }\r\n    };\r\n    return function () {\r\n        var /** @type {?} */ now = Date.now();\r\n        if (!previous && options.leading === false) {\r\n            previous = now;\r\n        }\r\n        var /** @type {?} */ remaining = wait - (now - previous);\r\n        context = this;\r\n        args = arguments;\r\n        if (remaining <= 0 || remaining > wait) {\r\n            if (timeout) {\r\n                clearTimeout(timeout);\r\n                timeout = null;\r\n            }\r\n            previous = now;\r\n            result = func.apply(context, args);\r\n            if (!timeout) {\r\n                context = args = null;\r\n            }\r\n        }\r\n        else if (!timeout && options.trailing !== false) {\r\n            timeout = setTimeout(later, remaining);\r\n        }\r\n        return result;\r\n    };\r\n}\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar checkDatasource = function (datasource) {\r\n    if (!datasource) {\r\n        throw new Error('No datasource provided');\r\n    }\r\n    if (!('get' in datasource)) {\r\n        throw new Error('Datasource get method is not implemented');\r\n    }\r\n    if (typeof datasource.get !== 'function') {\r\n        throw new Error('Datasource get is not a function');\r\n    }\r\n    if (datasource.get.length < 2) {\r\n        throw new Error('Datasource get method invalid signature');\r\n    }\r\n    return datasource;\r\n};\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar Workflow = /** @class */ (function () {\r\n    function Workflow(context) {\r\n        var _this = this;\r\n        this.count = 0;\r\n        this.countDone = 0;\r\n        this.resolver = Observable.Observable.create(function (_observer) { return _this.observer = _observer; });\r\n        this.bindData = function () {\r\n            _this.next = true;\r\n            context.changeDetector.markForCheck();\r\n        };\r\n        this.datasource = checkDatasource(context.datasource);\r\n        this.settings = new Settings(context.datasource.settings);\r\n        this.routines = new Routines(this.settings);\r\n        this.viewport = new Viewport(context.elementRef, this.settings, this.routines);\r\n        this.buffer = new Buffer();\r\n        this.fetch = new FetchModel();\r\n        this.clip = new ClipModel();\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.reset = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.pending = false;\r\n        this.direction = null;\r\n        this.scroll = false;\r\n        this.next = false;\r\n        this.fetch.reset();\r\n        this.clip = new ClipModel();\r\n    };\r\n    /**\r\n     * @param {?=} options\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.start = /**\r\n     * @param {?=} options\r\n     * @return {?}\r\n     */\r\n    function (options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.count++;\r\n        this.log(\"---=== Workflow \" + this.count + \" run\");\r\n        this.reset();\r\n        this.pending = true;\r\n        this.direction = options.direction || null;\r\n        this.scroll = options.scroll || false;\r\n        return Promise.resolve(this);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.continue = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.finalize = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        // stop 1 cycle\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.end = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.pending = false;\r\n        this.countDone++;\r\n        this.viewport.saveScrollPosition();\r\n        this.finalize();\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.done = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.log(\"---=== Workflow \" + this.count + \" done\");\r\n        this.end();\r\n        this.observer.next(this.next);\r\n    };\r\n    /**\r\n     * @param {?} error\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.fail = /**\r\n     * @param {?} error\r\n     * @return {?}\r\n     */\r\n    function (error) {\r\n        this.log(\"---=== Workflow \" + this.count + \" fail\");\r\n        this.end();\r\n        this.observer.error(error);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.dispose = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.observer.complete();\r\n    };\r\n    /**\r\n     * @param {...?} args\r\n     * @return {?}\r\n     */\r\n    Workflow.prototype.log = /**\r\n     * @param {...?} args\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (this.settings.debug) {\r\n            console.log.apply(this, args);\r\n        }\r\n    };\r\n    return Workflow;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar ShouldFetch = /** @class */ (function () {\r\n    function ShouldFetch() {\r\n    }\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    ShouldFetch.run = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        if (workflow.direction !== Direction.backward) {\r\n            ShouldFetch.shouldFetchByDirection(Direction.forward, workflow);\r\n        }\r\n        if (workflow.direction !== Direction.forward) {\r\n            ShouldFetch.shouldFetchByDirection(Direction.backward, workflow);\r\n        }\r\n        return Promise.resolve(workflow);\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    ShouldFetch.shouldFetchByDirection = /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (direction, workflow) {\r\n        var /** @type {?} */ paddingEdge = workflow.viewport.padding[direction].getEdge();\r\n        var /** @type {?} */ limit = workflow.viewport.getLimit(direction);\r\n        if ((direction === Direction.forward && workflow.buffer.eof) ||\r\n            (direction === Direction.backward && workflow.buffer.bof)) {\r\n            workflow.fetch[direction].shouldFetch = false;\r\n        }\r\n        else {\r\n            workflow.fetch[direction].shouldFetch =\r\n                (direction === Direction.forward) ? paddingEdge < limit : paddingEdge > limit;\r\n        }\r\n        if (workflow.fetch[direction].shouldFetch) {\r\n            ShouldFetch.setStartIndex(direction, workflow);\r\n        }\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    ShouldFetch.setStartIndex = /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (direction, workflow) {\r\n        var /** @type {?} */ forward = direction === Direction.forward;\r\n        var /** @type {?} */ back = -workflow.settings.bufferSize;\r\n        var /** @type {?} */ start;\r\n        if (workflow.buffer.lastIndex[direction] === null) {\r\n            start = workflow.settings.startIndex + (forward ? 0 : back);\r\n        }\r\n        else {\r\n            start = workflow.buffer.lastIndex[direction] + (forward ? 1 : back);\r\n        }\r\n        workflow.fetch[direction].startIndex = start;\r\n    };\r\n    return ShouldFetch;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar Fetch = /** @class */ (function () {\r\n    function Fetch() {\r\n    }\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    Fetch.run = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        var /** @type {?} */ result = [];\r\n        if (workflow.fetch[Direction.backward].shouldFetch) {\r\n            result.push(Fetch.fetchByDirection(Direction.backward, workflow));\r\n        }\r\n        if (workflow.fetch[Direction.forward].shouldFetch) {\r\n            result.push(Fetch.fetchByDirection(Direction.forward, workflow));\r\n        }\r\n        return Promise.all(result).then(function () { return workflow; });\r\n    };\r\n    /**\r\n     * @param {?} data\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    Fetch.success = /**\r\n     * @param {?} data\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (data, direction, workflow) {\r\n        workflow.log(\"resolved \" + data.length + \" \" + direction + \" items \" +\r\n            (\"(index = \" + workflow.fetch[direction].startIndex + \", count = \" + workflow.settings.bufferSize + \")\"));\r\n        workflow.fetch[direction].newItemsData = data;\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    Fetch.fetchByDirection = /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (direction, workflow) {\r\n        var /** @type {?} */ result = new Promise(function (resolve, reject) {\r\n            var /** @type {?} */ success = function (data) {\r\n                Fetch.success(data, direction, workflow);\r\n                resolve(true);\r\n            };\r\n            var /** @type {?} */ _get = /** @type {?} */ (workflow.datasource.get);\r\n            var /** @type {?} */ _getResult = _get(workflow.fetch[direction].startIndex, workflow.settings.bufferSize, success, reject);\r\n            if (_getResult && typeof _getResult.then === 'function') {\r\n                // DatasourceGetPromise\r\n                _getResult.then(success, reject);\r\n            }\r\n            else if (_getResult && typeof _getResult.subscribe === 'function') {\r\n                // DatasourceGetObservable\r\n                _getResult.subscribe(success, reject);\r\n            }\r\n        });\r\n        return result;\r\n    };\r\n    return Fetch;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar Item = /** @class */ (function () {\r\n    function Item($index, data, nodeId, routines) {\r\n        this.$index = $index;\r\n        this.data = data;\r\n        this.nodeId = nodeId;\r\n        this.routines = routines;\r\n        this.invisible = true;\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Item.prototype.getParams = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return this.routines.getParams(this.element);\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @return {?}\r\n     */\r\n    Item.prototype.getEdge = /**\r\n     * @param {?} direction\r\n     * @return {?}\r\n     */\r\n    function (direction) {\r\n        return this.routines.getEdge(this.element, direction, false);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    Item.prototype.hide = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.routines.hideElement(this.element);\r\n    };\r\n    return Item;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar ProcessFetch = /** @class */ (function () {\r\n    function ProcessFetch() {\r\n    }\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    ProcessFetch.run = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        ProcessFetch.runByDirection(workflow, Direction.backward);\r\n        ProcessFetch.runByDirection(workflow, Direction.forward);\r\n        return workflow;\r\n    };\r\n    /**\r\n     * @param {?} workflow\r\n     * @param {?} direction\r\n     * @return {?}\r\n     */\r\n    ProcessFetch.runByDirection = /**\r\n     * @param {?} workflow\r\n     * @param {?} direction\r\n     * @return {?}\r\n     */\r\n    function (workflow, direction) {\r\n        var /** @type {?} */ fetch = workflow.fetch[direction];\r\n        if (!fetch.newItemsData) {\r\n            // no fetch\r\n            return;\r\n        }\r\n        var /** @type {?} */ eof = direction === Direction.forward ? 'eof' : 'bof';\r\n        workflow.buffer[eof] = fetch.newItemsData.length !== workflow.settings.bufferSize;\r\n        if (direction === Direction.backward && workflow.buffer.bof) {\r\n            fetch.startIndex += workflow.settings.bufferSize - fetch.newItemsData.length;\r\n        }\r\n        if (!fetch.newItemsData.length) {\r\n            // empty result\r\n            return;\r\n        }\r\n        fetch.items = fetch.newItemsData.map(function (item, index) {\r\n            var /** @type {?} */ $index = fetch.startIndex + index;\r\n            var /** @type {?} */ nodeId = workflow.settings.itemIdPrefix + String($index);\r\n            return new Item($index, item, nodeId, workflow.routines);\r\n        });\r\n        if (direction === Direction.forward) {\r\n            workflow.buffer.items = workflow.buffer.items.concat(fetch.items);\r\n        }\r\n        else {\r\n            workflow.buffer.items = fetch.items.concat(workflow.buffer.items);\r\n        }\r\n    };\r\n    return ProcessFetch;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar Render = /** @class */ (function () {\r\n    function Render() {\r\n    }\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    Render.run = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        if (!workflow.fetch.hasNewItems) {\r\n            return workflow;\r\n        }\r\n        workflow.bindData();\r\n        return new Promise(function (resolve, reject) {\r\n            return setTimeout(function () {\r\n                var /** @type {?} */ error = Render.setElements(workflow);\r\n                if (!error) {\r\n                    resolve(workflow);\r\n                }\r\n                else {\r\n                    reject(error);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    Render.setElements = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        var /** @type {?} */ items = workflow.fetch.items;\r\n        for (var /** @type {?} */ j = items.length - 1; j >= 0; j--) {\r\n            var /** @type {?} */ nodes = workflow.viewport.children;\r\n            for (var /** @type {?} */ i = nodes.length - 1; i >= 0; i--) {\r\n                if (nodes[i].getAttribute('data-sid') === items[j].nodeId) {\r\n                    items[j].element = nodes[i];\r\n                }\r\n            }\r\n            if (!items[j].element) {\r\n                // todo: do we really need this check?\r\n                return new Error('Can not associate item with element');\r\n            }\r\n        }\r\n    };\r\n    return Render;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar AdjustFetch = /** @class */ (function () {\r\n    function AdjustFetch() {\r\n    }\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    AdjustFetch.run = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        AdjustFetch.runByDirection(Direction.forward, workflow);\r\n        AdjustFetch.runByDirection(Direction.backward, workflow);\r\n        return workflow;\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    AdjustFetch.runByDirection = /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (direction, workflow) {\r\n        var /** @type {?} */ items = workflow.fetch[direction].items;\r\n        if (!items) {\r\n            return;\r\n        }\r\n        AdjustFetch.processFetchedItems(items);\r\n        var /** @type {?} */ height = Math.abs(items[0].getEdge(Direction.backward) -\r\n            items[items.length - 1].getEdge(Direction.forward));\r\n        if (direction === Direction.forward) {\r\n            return this.adjustForward(workflow, height);\r\n        }\r\n        else {\r\n            return this.adjustBackward(workflow, height);\r\n        }\r\n    };\r\n    /**\r\n     * @param {?} items\r\n     * @return {?}\r\n     */\r\n    AdjustFetch.processFetchedItems = /**\r\n     * @param {?} items\r\n     * @return {?}\r\n     */\r\n    function (items) {\r\n        for (var /** @type {?} */ i = items.length - 1; i >= 0; i--) {\r\n            var /** @type {?} */ element = items[i].element.children[0];\r\n            element.style.left = '';\r\n            element.style.position = '';\r\n            items[i].invisible = false;\r\n        }\r\n    };\r\n    /**\r\n     * @param {?} workflow\r\n     * @param {?} size\r\n     * @return {?}\r\n     */\r\n    AdjustFetch.adjustForward = /**\r\n     * @param {?} workflow\r\n     * @param {?} size\r\n     * @return {?}\r\n     */\r\n    function (workflow, size) {\r\n        var /** @type {?} */ paddingForward = workflow.viewport.padding[Direction.forward];\r\n        var /** @type {?} */ _paddingSize = paddingForward.size || 0;\r\n        paddingForward.size = Math.max(_paddingSize - size, 0);\r\n    };\r\n    /**\r\n     * @param {?} workflow\r\n     * @param {?} size\r\n     * @return {?}\r\n     */\r\n    AdjustFetch.adjustBackward = /**\r\n     * @param {?} workflow\r\n     * @param {?} size\r\n     * @return {?}\r\n     */\r\n    function (workflow, size) {\r\n        var /** @type {?} */ viewport = workflow.viewport;\r\n        var /** @type {?} */ _scrollPosition = viewport.scrollPosition;\r\n        var /** @type {?} */ paddingBackward = viewport.padding[Direction.backward];\r\n        var /** @type {?} */ paddingForward = viewport.padding[Direction.forward];\r\n        // need to make \"size\" pixels in backward direction\r\n        // 1) via paddingTop\r\n        var /** @type {?} */ _paddingSize = paddingBackward.size || 0;\r\n        var /** @type {?} */ paddingSize = Math.max(_paddingSize - size, 0);\r\n        paddingBackward.size = paddingSize;\r\n        var /** @type {?} */ paddingDiff = size - (_paddingSize - paddingSize);\r\n        // 2) via scrollTop\r\n        if (paddingDiff > 0) {\r\n            size = paddingDiff;\r\n            viewport.scrollPosition += size;\r\n            var /** @type {?} */ diff = size - viewport.scrollPosition - _scrollPosition;\r\n            if (diff > 0) {\r\n                paddingSize = paddingForward.size || 0;\r\n                paddingForward.size = paddingSize + diff;\r\n                viewport.scrollPosition += diff;\r\n            }\r\n        }\r\n    };\r\n    return AdjustFetch;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar ShouldClip = /** @class */ (function () {\r\n    function ShouldClip() {\r\n    }\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    ShouldClip.run = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        var /** @type {?} */ fetchOnly = workflow.settings.clipAfterFetchOnly;\r\n        var /** @type {?} */ scrollOnly = workflow.settings.clipAfterScrollOnly;\r\n        if (!workflow.buffer.items.length) {\r\n            return workflow;\r\n        }\r\n        if (scrollOnly && !workflow.scroll) {\r\n            return workflow;\r\n        }\r\n        if (!fetchOnly || workflow.fetch[Direction.backward].shouldFetch) {\r\n            ShouldClip.shouldClipByDirection(Direction.backward, workflow);\r\n        }\r\n        if (!fetchOnly || workflow.fetch[Direction.forward].shouldFetch) {\r\n            ShouldClip.shouldClipByDirection(Direction.forward, workflow);\r\n        }\r\n        return workflow;\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    ShouldClip.shouldClipByDirection = /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (direction, workflow) {\r\n        var /** @type {?} */ items = workflow.buffer.items;\r\n        var /** @type {?} */ forward = direction === Direction.forward;\r\n        var /** @type {?} */ viewport = workflow.viewport;\r\n        var /** @type {?} */ viewportLimit = viewport.getLimit(direction, true);\r\n        var /** @type {?} */ firstIndex = workflow.buffer.getFirstVisibleItemIndex();\r\n        var /** @type {?} */ lastIndex = workflow.buffer.getLastVisibleItemIndex();\r\n        var /** @type {?} */ firstItemEdge = items[firstIndex].getEdge(direction);\r\n        var /** @type {?} */ lastItemEdge = items[lastIndex].getEdge(direction);\r\n        var /** @type {?} */ i, /** @type {?} */ itemEdge, /** @type {?} */ start = -1, /** @type {?} */ end = -1;\r\n        var /** @type {?} */ getItemEdge = function (index) {\r\n            return index === firstIndex ? firstItemEdge : (index === lastIndex ? lastItemEdge :\r\n                items[index].getEdge(direction));\r\n        };\r\n        if ((forward && lastItemEdge <= viewportLimit) || (!forward && firstItemEdge >= viewportLimit)) {\r\n            // all items should be clipped\r\n            start = firstIndex;\r\n            end = lastIndex;\r\n        }\r\n        else {\r\n            if (forward) {\r\n                start = firstIndex;\r\n            }\r\n            else {\r\n                end = lastIndex;\r\n            }\r\n            for (forward ? (i = 0) : (i = lastIndex); forward ? (i <= lastIndex) : (i >= 0); forward ? i++ : i--) {\r\n                itemEdge = getItemEdge(i);\r\n                if (forward && itemEdge <= viewportLimit) {\r\n                    end = i;\r\n                }\r\n                else if (!forward && itemEdge >= viewportLimit) {\r\n                    start = i;\r\n                }\r\n                else {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (start >= 0 && end >= 0) {\r\n            for (i = start; i <= end; i++) {\r\n                items[i].toRemove = true;\r\n            }\r\n            workflow.clip[direction].shouldClip = true;\r\n            workflow.clip[direction].size =\r\n                items[end].getEdge(Direction.forward) - items[start].getEdge(Direction.backward);\r\n        }\r\n    };\r\n    return ShouldClip;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar Clip = /** @class */ (function () {\r\n    function Clip() {\r\n    }\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    Clip.run = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        if (!workflow.clip.shouldClip) {\r\n            return workflow;\r\n        }\r\n        Clip.runByDirection(Direction.forward, workflow);\r\n        Clip.runByDirection(Direction.backward, workflow);\r\n        workflow.buffer.items = workflow.buffer.items.filter(function (item) {\r\n            if (item.toRemove) {\r\n                workflow.buffer.cache.add(item);\r\n                item.hide();\r\n                return false;\r\n            }\r\n            return true;\r\n        });\r\n        workflow.bindData();\r\n        return new Promise(function (resolve, reject) {\r\n            return setTimeout(function () {\r\n                Clip.processClip(workflow);\r\n                resolve(workflow);\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    Clip.runByDirection = /**\r\n     * @param {?} direction\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (direction, workflow) {\r\n        if (!workflow.clip[direction].shouldClip) {\r\n            return;\r\n        }\r\n        var /** @type {?} */ opposite = direction === Direction.forward ? Direction.backward : Direction.forward;\r\n        workflow.viewport.padding[opposite].size += workflow.clip[direction].size;\r\n    };\r\n    /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    Clip.processClip = /**\r\n     * @param {?} workflow\r\n     * @return {?}\r\n     */\r\n    function (workflow) {\r\n        if (!workflow.clip[Direction.backward].shouldClip) {\r\n            workflow.buffer.bof = false;\r\n        }\r\n        if (!workflow.clip[Direction.forward].shouldClip) {\r\n            workflow.buffer.eof = false;\r\n        }\r\n    };\r\n    return Clip;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar WorkflowRunner = /** @class */ (function () {\r\n    function WorkflowRunner(context) {\r\n        this.defaultDirection = Direction.forward;\r\n        this.context = context;\r\n        this.workflow = new Workflow(this.context);\r\n        this.count = 0;\r\n        this.runQueue = null;\r\n        this.runNew = null;\r\n        this.initialize();\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    WorkflowRunner.prototype.initialize = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        var _this = this;\r\n        var /** @type {?} */ flow = this.workflow;\r\n        var /** @type {?} */ onScroll = function ($event) { return _this.scroll($event); };\r\n        this.onScrollListener =\r\n            this.context.renderer.listen(flow.viewport.scrollable, 'scroll', throttle(onScroll, 100));\r\n        this.itemsSubscription = flow.buffer.$items.subscribe(function (items) { return _this.context.items = items; });\r\n        this.flowResolverSubscription = flow.resolver.subscribe(this.resolve.bind(this));\r\n        this.run();\r\n    };\r\n    /**\r\n     * @param {?} $event\r\n     * @return {?}\r\n     */\r\n    WorkflowRunner.prototype.scroll = /**\r\n     * @param {?} $event\r\n     * @return {?}\r\n     */\r\n    function ($event) {\r\n        if (this.workflow.viewport.syntheticScrollPosition !== null) {\r\n            if (this.workflow.viewport.scrollPosition === this.workflow.viewport.syntheticScrollPosition) {\r\n                this.workflow.viewport.syntheticScrollPosition = null;\r\n                return;\r\n            }\r\n            this.workflow.viewport.syntheticScrollPosition = null;\r\n        }\r\n        this.run({ scroll: true });\r\n    };\r\n    /**\r\n     * @param {?} next\r\n     * @return {?}\r\n     */\r\n    WorkflowRunner.prototype.resolve = /**\r\n     * @param {?} next\r\n     * @return {?}\r\n     */\r\n    function (next) {\r\n        if (this.runNew) {\r\n            this.run(this.runNew);\r\n            this.runNew = null;\r\n        }\r\n        else if (next) {\r\n            this.run({\r\n                direction: this.workflow.direction,\r\n                scroll: this.workflow.scroll\r\n            });\r\n        }\r\n        else if (this.runQueue) {\r\n            this.run(this.runQueue);\r\n            this.runQueue = null;\r\n        }\r\n        else {\r\n            this.count++;\r\n            this.finalize();\r\n        }\r\n    };\r\n    /**\r\n     * @param {?=} options\r\n     * @return {?}\r\n     */\r\n    WorkflowRunner.prototype.run = /**\r\n     * @param {?=} options\r\n     * @return {?}\r\n     */\r\n    function (options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        if (!options.direction) {\r\n            options.direction = this.defaultDirection;\r\n            this.runQueue = __assign({}, options, { direction: options.direction === Direction.forward ? Direction.backward : Direction.forward });\r\n        }\r\n        if (this.workflow.pending) {\r\n            this.runNew = __assign({}, options);\r\n            return;\r\n        }\r\n        this.workflow.start(options)\r\n            .then(function () { return _this.fetch(); })\r\n            .then(function () { return _this.clip(); })\r\n            .then(function () {\r\n            return _this.workflow.done();\r\n        })\r\n            .catch(function (error) {\r\n            return _this.workflow.fail(error);\r\n        });\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    WorkflowRunner.prototype.fetch = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return this.workflow.continue()\r\n            .then(ShouldFetch.run)\r\n            .then(Fetch.run)\r\n            .then(ProcessFetch.run)\r\n            .then(Render.run)\r\n            .then(AdjustFetch.run);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    WorkflowRunner.prototype.clip = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        return this.workflow.settings.infinite ?\r\n            null :\r\n            this.workflow.continue()\r\n                .then(ShouldClip.run)\r\n                .then(Clip.run);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    WorkflowRunner.prototype.dispose = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.onScrollListener();\r\n        this.itemsSubscription.unsubscribe();\r\n        this.flowResolverSubscription.unsubscribe();\r\n        this.workflow.dispose();\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    WorkflowRunner.prototype.finalize = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        // stop queue\r\n        this.workflow.log(\"~~~~~~ WF Cycle \" + this.count + \" DONE ~~~~~~\");\r\n    };\r\n    return WorkflowRunner;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar UiScrollComponent = /** @class */ (function () {\r\n    function UiScrollComponent(changeDetector, elementRef, renderer) {\r\n        this.changeDetector = changeDetector;\r\n        this.elementRef = elementRef;\r\n        this.renderer = renderer;\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    UiScrollComponent.prototype.ngOnInit = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.workflowRunner = new WorkflowRunner(this);\r\n    };\r\n    /**\r\n     * @return {?}\r\n     */\r\n    UiScrollComponent.prototype.ngOnDestroy = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        this.workflowRunner.dispose();\r\n    };\r\n    UiScrollComponent.decorators = [\r\n        { type: core.Component, args: [{\r\n                    selector: 'ui-scroll',\r\n                    changeDetection: core.ChangeDetectionStrategy.OnPush,\r\n                    template: \"<div data-padding-backward></div><div\\n  *ngFor=\\\"let item of items\\\" [attr.data-sid]=\\\"item.nodeId\\\"\\n><div\\n  [style.position]=\\\"item.invisible ? 'fixed' : null\\\"\\n  [style.left]=\\\"item.invisible ? '-99999px' : null\\\"\\n><ng-template\\n  [ngTemplateOutlet]=\\\"template\\\"\\n  [ngTemplateOutletContext]=\\\"{\\n    $implicit: item.data,\\n    index: item.$index\\n }\\\"\\n></ng-template></div></div><div data-padding-forward></div>\"\r\n                },] },\r\n    ];\r\n    /** @nocollapse */\r\n    UiScrollComponent.ctorParameters = function () { return [\r\n        { type: core.ChangeDetectorRef, },\r\n        { type: core.ElementRef, },\r\n        { type: core.Renderer2, },\r\n    ]; };\r\n    return UiScrollComponent;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar UiScrollDirective = /** @class */ (function () {\r\n    function UiScrollDirective(templateRef, viewContainer, resolver) {\r\n        this.templateRef = templateRef;\r\n        this.viewContainer = viewContainer;\r\n        this.resolver = resolver;\r\n    }\r\n    Object.defineProperty(UiScrollDirective.prototype, \"uiScrollOf\", {\r\n        set: /**\r\n         * @param {?} datasource\r\n         * @return {?}\r\n         */\r\n        function (datasource) {\r\n            this.datasource = datasource;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @return {?}\r\n     */\r\n    UiScrollDirective.prototype.ngOnInit = /**\r\n     * @return {?}\r\n     */\r\n    function () {\r\n        var /** @type {?} */ templateView = this.templateRef.createEmbeddedView({});\r\n        var /** @type {?} */ compFactory = this.resolver.resolveComponentFactory(UiScrollComponent);\r\n        var /** @type {?} */ componentRef = this.viewContainer.createComponent(compFactory, null, this.viewContainer.injector, [templateView.rootNodes]);\r\n        componentRef.instance.datasource = this.datasource;\r\n        componentRef.instance.template = this.templateRef;\r\n    };\r\n    UiScrollDirective.decorators = [\r\n        { type: core.Directive, args: [{ selector: '[uiScroll][uiScrollOf]' },] },\r\n    ];\r\n    /** @nocollapse */\r\n    UiScrollDirective.ctorParameters = function () { return [\r\n        { type: core.TemplateRef, },\r\n        { type: core.ViewContainerRef, },\r\n        { type: core.ComponentFactoryResolver, },\r\n    ]; };\r\n    UiScrollDirective.propDecorators = {\r\n        \"uiScrollOf\": [{ type: core.Input },],\r\n    };\r\n    return UiScrollDirective;\r\n}());\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes} checked by tsc\r\n */\r\nvar UiScrollModule = /** @class */ (function () {\r\n    function UiScrollModule() {\r\n    }\r\n    UiScrollModule.decorators = [\r\n        { type: core.NgModule, args: [{\r\n                    declarations: [\r\n                        UiScrollComponent,\r\n                        UiScrollDirective\r\n                    ],\r\n                    imports: [common.CommonModule],\r\n                    entryComponents: [UiScrollComponent],\r\n                    exports: [UiScrollDirective],\r\n                    providers: []\r\n                },] },\r\n    ];\r\n    /** @nocollapse */\r\n    UiScrollModule.ctorParameters = function () { return []; };\r\n    return UiScrollModule;\r\n}());\n\nexports.UiScrollModule = UiScrollModule;\nexports.ɵa = UiScrollComponent;\nexports.ɵb = UiScrollDirective;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=ngx-ui-scroll.umd.js.map\n"]}